
cvmfs_test_name="Repository reload with config repository and manual mount"
cvmfs_test_suites="quick"
cvmfs_test_autofs_on_startup=false

# Test for CVM-1755
cvmfs_run_test() {
  logfile=$1

  # Disable autofs before manual mount
  autofs_switch off || return 1

  # Make sure CVMFS_HTTP_PROXY is present before manual mount
  sudo sh -c "echo \"CVMFS_HTTP_PROXY=DIRECT\" >> /etc/cvmfs/default.local"

  cvmfs_mount_direct sft.cern.ch || return 2
  mount | grep cvmfs-config.cern.ch || return 3

  cvmfs_umount cvmfs-config.cern.ch || return 10
  mount | grep cvmfs-config.cern.ch && return 11

  sudo cvmfs_config reload || return 20

  return 0
}
