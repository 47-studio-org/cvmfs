
cvmfs_test_name="Probing oasis"

CVMFS_TEST_045_PKG_MGR=

configure_and_mount_oasis() {
  sudo rpm -Uvh http://repo.grid.iu.edu/osg/3.2/osg-3.2-el6-release-latest.rpm || return 1
  sudo $CVMFS_TEST_045_PKG_MGR -y install oasis-config || return 2
  cvmfs_mount oasis.opensciencegrid.org,atlas.cern.ch \
    "CVMFS_HTTP_PROXY=DIRECT" || return 3

  return 0
}

cleanup_oasis() {
  cvmfs_umount oasis.opensciencegrid.org,atlas.cern.ch
  sudo $CVMFS_TEST_045_PKG_MGR -y erase oasis-config
  sudo rpm -e osg-release
  sudo rm -f /etc/cvmfs/domain.d/opensciencegrid.org.serverorder
}

cvmfs_run_test() {
  logfile=$1

  if which dnf > /dev/null 2>&1; then
    CVMFS_TEST_045_PKG_MGR="dnf"
  elif which yum > /dev/null 2>&1; then
    CVMFS_TEST_045_PKG_MGR="yum"
  else
    echo "neither 'yum' nor 'dnf' available..."
    return 1
  fi

  which rpm > /dev/null 2>&1 || return 2

  echo "using '$CVMFS_TEST_045_PKG_MGR' for installing packages"

  configure_and_mount_oasis
  local retval=$?
  cleanup_oasis

  return $retval
}
