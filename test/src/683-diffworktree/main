cvmfs_test_name="Set base hash in diff command"
cvmfs_test_autofs_on_startup=false
cvmfs_test_suites="quick"

cvmfs_run_test() {
  logfile=$1

  echo "*** Create a new repository"
  create_empty_repo $CVMFS_TEST_REPO $CVMFS_TEST_USER || return 1

  echo "*** Start a transaction"
  start_transaction $CVMFS_TEST_REPO || return 2
  echo "*** Edit repository"
  touch /cvmfs/$CVMFS_TEST_REPO/new_file.txt || return 3
  echo "*** Run diff command"
  cvmfs_server diff --worktree $CVMFS_TEST_REPO || return 4
  echo "*** Abort transaction"
  abort_transaction $CVMFS_TEST_REPO || return 5

  return 0
}
